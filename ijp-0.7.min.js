var Ical=function(){this.version="",this.prodid="",this.events=[],this.todos=[],this.journals=[],this.freebusys=[]},xprops="x-[^:;]+",ianaprops="[\\w]+[^:;]+",icalParser={icals:[],propsList:{event:"(dtstamp|uid|dtstart|class|created|description|geo|last-mod|location|organizer|priority|seq|status|summary|transp|url|recurid|rrule|dtend|duration|attach|attendee|categories|comment|contact|exdate|rstatus|related|resources|rdate|"+xprops+"|"+ianaprops+")",freebusy:"(dtstamp|uid|contact|dtstart|dtend|organizer|url|attendee|comment|freebusy|rstatus|"+xprops+"|"+ianaprops+")",journal:"(dtstamp|uid|class|created|dtstart|last-mod|organizer|recurid|seq|status|summary|url|rrule|attach|attendee|categories|comment|contact|description|exdate|related|rdate|rstatus|"+xprops+"|"+ianaprops+")",todo:"(dtstamp|uid|class|completed|created|description|dtstart|geo|last-mod|location|organizer|percent|priority|recurid|seq|status|summary|url|rrule|due|duration|attach|attendee|categories|comment|contact|exdate|rstatus|related|resources|rdate|"+xprops+"|"+ianaprops+")"},parseIcal:function(e){var t=e.match(/BEGIN:VCALENDAR\r?\n(.*\r?\n)+?END:VCALENDAR/gi);for(var r in t){var a=new Ical;a.version=this.getValue("VERSION",t[r]),a.prodid=this.getValue("PRODID",t[r]),t[r]=t[r].replace(/\r\n /g,""),t[r]=t[r].replace(/BEGIN:VCALENDAR\r?\n/gi,"");var s=/BEGIN:(V.*?)\r?\n(.*\r?\n)+?END:\1/gi;if(matches=t[r].match(s),matches)for(i=0;i<matches.length;i++)this.parseVComponent(matches[i],a);this.icals[this.icals.length]=a}},parseVComponent:function(e,t){var r=e.match(/BEGIN:V([^\s]+)/i)[1].toLowerCase();e=e.replace(/\r?\n[\s]+/gim,""),e=e.replace(/(^begin|^end):.*/gim,"");var a=e.match(new RegExp(this.propsList[r]+"[:;].*","gim"));if(a){var s=[];for(var i in a){var n=a[i].replace(/[:;].*$/,""),o=n.toLowerCase();void 0===s[o]&&(s[o]=[]),s[o][s[o].length]=this.getValue(n,a[i]),s.raw=e}void 0!==t[r+"s"]&&(t[r+"s"][t[r+"s"].length]=s)}},getValue:function(e,t){var r={};t=t.replace(/^\s+/g,"").replace(/\s+$/gi,""),reg=new RegExp("("+e+")((?:;[^=]*=[^;:\n]*)*):([^\n\r]*)","gi");var a=reg.exec(t);if(a){var s=RegExp.$3,i=[];if(RegExp.$2.length>0){var n,o=RegExp.$2.substr(1).split(";");for(k=0;k<o.length;k++)n=o[k].split("="),n[1]||(n[1]=n[0]),i[n[0]]=n[1]}r={value:s,name:e},Object.keys(i).length>0&&(r.params=i)}return r}};